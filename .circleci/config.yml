version: 2

executors:
  linux_executor:
    machine:
      - image: circleci/ruby:2.5.1
      - image: circleci/nodejs:8.0.0

jobs:
  setup:
    executor: linux_executor
    steps:
      - checkout
      - run:
          name: Set up environment
          command: ./bin/setup
  test:
    executor: linux_executor
    steps:
      - checkout
      - run:
          name: Run tests
          command: |
            bundle exec jekyll build
            rm -R ./_site/node_modules
            bundle exec htmlproofer ./_site --only-4xx --allow-hash-href --assume-extension --check-opengraph --url-ignore "feed.xml"

workflows:
  version: 2
  test_all:
    jobs:
      - setup
      - test:
          requires:
          - setup
